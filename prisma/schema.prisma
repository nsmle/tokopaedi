generator client {
    provider     = "prisma-client-js"
    moduleFormat = "esm"
    adapter      = "pg"
    runtime      = "vercel-edge"
    output       = "../.next/prisma"

    previewFeatures = ["fullTextSearchPostgres"]
}

datasource db {
    provider     = "postgresql"
    relationMode = "prisma"
}

// ========================
// -------- Models --------
// ========================

model Store {
    id          BigInt    @id @default(autoincrement())
    slug        String    @unique
    name        String
    city        String?
    url         String
    reputation  String?
    warehouseId BigInt?   @map("warehouse_id")
    products    Product[]

    @@index([slug])
    @@map("stores")
}

model Category {
    id       BigInt    @id @default(autoincrement())
    slug     String    @unique
    name     String
    url      String
    products Product[]

    @@index([slug])
    @@map("categories")
}

model Discount {
    id          BigInt  @id @default(autoincrement())
    productId   BigInt  @unique @map("product_id")
    name        String?
    description String?

    percentage Float
    validFrom  DateTime? @map("valid_from")
    validTo    DateTime? @map("valid_to")

    products Product[]

    @@index([productId])
    @@map("discounts")
}

model ProductImage {
    id        String  @id @default(uuid())
    productId BigInt  @map("product_id")
    url       String
    product   Product @relation(fields: [productId], references: [id], map: "ProductImage_product_fkey", onDelete: Cascade)

    @@index([productId])
    @@map("product_images")
}

model Product {
    id          BigInt         @id @default(autoincrement())
    parentId    BigInt?        @map("parent_id")
    slug        String         @unique
    name        String
    description String?
    minOrder    Int            @default(1) @map("min_order")
    maxOrder    Int            @default(1) @map("max_order")
    weight      Int?
    weightUnit  String?        @map("weight_unit")
    condition   String
    status      String
    url         String
    thumbnail   String?
    images      ProductImage[]
    price       Int
    storeId     BigInt
    categoryId  BigInt

    store     Store      @relation(fields: [storeId], references: [id])
    category  Category   @relation(fields: [categoryId], references: [id])
    discount  Discount?  @relation(fields: [id], references: [productId], map: "Product_discount_fkey", onDelete: Cascade)
    statistic Statistic? @relation(fields: [id], references: [productId], map: "Product_statistic_fkey", onDelete: Cascade)

    @@index([parentId])
    @@index([storeId])
    @@index([categoryId])
    @@index([slug])
    @@map("products")
}

model Statistic {
    id        BigInt @id @default(autoincrement())
    productId BigInt @unique @map("product_id")
    success   Int    @map("transaction_success")
    reject    Int    @map("transaction_reject")
    sold      Int    @map("sold_count")
    view      Int    @map("view_count")
    review    Int    @map("review_count")
    talk      Int    @map("talk_count")
    rating    Float

    products Product[]

    @@index([productId])
    @@map("statistics")
}
